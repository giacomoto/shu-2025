<div class="citizen-container">
  <!-- Page Title Header -->
  <header class="page-title-header">
    <div class="page-title-content">
      <h1 class="page-title">{{ getPageTitle() }}</h1>
      <p class="page-subtitle">{{ getPageSubtitle() }}</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Services Tab -->
    <div class="tab-content" *ngIf="currentTab === 'services'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('services'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Transport Tab -->
    <div class="tab-content" *ngIf="currentTab === 'transport'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('transport'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Health Tab -->
    <div class="tab-content" *ngIf="currentTab === 'health'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('health'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Education Tab -->
    <div class="tab-content" *ngIf="currentTab === 'education'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('education'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Events Tab -->
    <div class="tab-content" *ngIf="currentTab === 'events'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('events'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- News Tab -->
    <div class="tab-content" *ngIf="currentTab === 'news'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('news'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Culture Tab -->
    <div class="tab-content" *ngIf="currentTab === 'culture'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('culture'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Sports Tab -->
    <div class="tab-content" *ngIf="currentTab === 'sports'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('sports'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Emergency Tab -->
    <div class="tab-content" *ngIf="currentTab === 'emergency'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('emergency'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Shopping Tab -->
    <div class="tab-content" *ngIf="currentTab === 'shopping'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('shopping'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>
  </main>

  <!-- Bottom Tab Navigation -->
  <nav class="bottom-tab-navigation">
    <button class="tab-button" *ngFor="let category of categories" [class.active]="currentTab === category.id"
      (click)="setTab(category.id)">
      <span class="tab-icon">{{ category.icon }}</span>
      <span class="tab-label">{{ category.name }}</span>
    </button>
  </nav>

  <!-- Floating Action Button -->
  <button class="fab-button" (click)="openChatbot()" [attr.aria-label]="'Open chatbot'">
    <span class="fab-icon">ðŸ¤–</span>
  </button>

  <!-- Chatbot Modal -->
  <div class="modal-overlay" *ngIf="isChatbotOpen" [class.closing]="isClosing" (click)="closeChatbot()">
    <div class="modal-content" [class.closing]="isClosing" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Chat with Olivia</h2>
        <button class="close-button" (click)="closeChatbot()">
          <span class="close-icon">Ã—</span>
        </button>
      </div>
      
      <div class="chatbot-container">
        <!-- Chat Messages -->
        <div class="chat-messages" #chatMessages>
          <!-- Welcome Message -->
          <div class="message bot-message">
            <div class="message-avatar">ðŸ¤–</div>
            <div class="message-content">
              <div class="message-bubble bot-bubble">
                <p>Hello! I'm Olivia, your virtual assistant for Spello citizens. I can help you with information about city services, transport, healthcare, events, and more. How can I assist you today?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
          </div>

          <!-- Sample User Message -->
          <div class="message user-message">
            <div class="message-content">
              <div class="message-bubble user-bubble">
                <p>Where can I pay my local taxes?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
            <div class="message-avatar">ðŸ‘¤</div>
          </div>

          <!-- Sample Bot Response -->
          <div class="message bot-message">
            <div class="message-avatar">ðŸ¤–</div>
            <div class="message-content">
              <div class="message-bubble bot-bubble">
                <p>You can pay your local taxes (IMU, TARI, etc.) through several methods:</p>
                <ul>
                  <li><strong>Online</strong> - Through the municipality website</li>
                  <li><strong>In person</strong> - At the municipal offices during business hours</li>
                  <li><strong>Bank transfer</strong> - Using the payment slips you received</li>
                  <li><strong>Post office</strong> - At any Poste Italiane location</li>
                </ul>
                <p>You can find the Tax Payments service in the Services section above. Would you like more specific information about any of these methods?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
          </div>

          <!-- Another User Message -->
          <div class="message user-message">
            <div class="message-content">
              <div class="message-bubble user-bubble">
                <p>What are the bus schedules for today?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
            <div class="message-avatar">ðŸ‘¤</div>
          </div>

          <!-- Another Bot Response -->
          <div class="message bot-message">
            <div class="message-avatar">ðŸ¤–</div>
            <div class="message-content">
              <div class="message-bubble bot-bubble">
                <p>For current bus schedules, you can check the Transport section where you'll find:</p>
                <ul>
                  <li><strong>Bus Schedules</strong> - Local and regional routes</li>
                  <li><strong>Umbria MobilitÃ </strong> - Official transport website</li>
                  <li><strong>Real-time updates</strong> - Current delays and changes</li>
                </ul>
                <p>The main routes from Spello connect to Perugia, Assisi, and other nearby towns. Would you like information about a specific route?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
          </div>
        </div>

        <!-- Chat Input -->
        <div class="chat-input-container">
          <div class="chat-input-wrapper">
            <input type="text" 
                   class="chat-input" 
                   placeholder="Ask me about city services, transport, events..."
                   #chatInput>
            <button class="send-button" (click)="sendMessage(chatInput.value); chatInput.value = ''">
              <span class="send-icon">ðŸ“¤</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>