<div class="citizen-container">
  <!-- Page Title Header -->
  <header class="page-title-header">
    <div class="page-title-content">
      <h1 class="page-title">{{ getPageTitle() }}</h1>
      <p class="page-subtitle">{{ getPageSubtitle() }}</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Services Tab -->
    <div class="tab-content" *ngIf="currentTab === 'services'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('services'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Transport Tab -->
    <div class="tab-content" *ngIf="currentTab === 'transport'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('transport'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Health Tab -->
    <div class="tab-content" *ngIf="currentTab === 'health'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('health'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Education Tab -->
    <div class="tab-content" *ngIf="currentTab === 'education'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('education'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Events Tab -->
    <div class="tab-content" *ngIf="currentTab === 'events'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('events'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- News Tab -->
    <div class="tab-content" *ngIf="currentTab === 'news'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('news'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Culture Tab -->
    <div class="tab-content" *ngIf="currentTab === 'culture'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('culture'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Sports Tab -->
    <div class="tab-content" *ngIf="currentTab === 'sports'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('sports'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Emergency Tab -->
    <div class="tab-content" *ngIf="currentTab === 'emergency'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('emergency'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Shopping Tab -->
    <div class="tab-content" *ngIf="currentTab === 'shopping'">
      <div class="links-grid">
        <div class="link-card" *ngFor="let link of getLinksByCategory('shopping'); trackBy: trackByLink"
          (click)="openLink(link)">
          <div class="link-icon">{{ link.icon }}</div>
          <div class="link-info">
            <h3 class="link-title">{{ link.title }}</h3>
            <p class="link-description">{{ link.description }}</p>
          </div>
          <div class="link-arrow">â†’</div>
        </div>
      </div>
    </div>

    <!-- Report Issue Tab -->
    <div class="tab-content" *ngIf="currentTab === 'report'">
      <div class="report-form-container">
        <div class="report-form">
          <div class="form-section">
            <h3 class="section-title">Issue Information</h3>
            
            <!-- Issue Type Selection -->
            <div class="form-group">
              <label class="form-label">Type of Issue *</label>
              <div class="issue-type-grid">
                <button 
                  *ngFor="let type of issueTypes" 
                  class="issue-type-button"
                  [class.selected]="reportForm.issueType === type.value"
                  (click)="reportForm.issueType = type.value">
                  <span class="issue-type-icon">{{ type.icon }}</span>
                  <span class="issue-type-label">{{ type.label }}</span>
                </button>
              </div>
            </div>

            <!-- Title -->
            <div class="form-group">
              <label class="form-label" for="issue-title">Title *</label>
              <input 
                type="text" 
                id="issue-title"
                class="form-input" 
                placeholder="Brief description of the issue"
                [(ngModel)]="reportForm.title">
            </div>

            <!-- Description -->
            <div class="form-group">
              <label class="form-label" for="issue-description">Description *</label>
              <textarea 
                id="issue-description"
                class="form-textarea" 
                placeholder="Provide detailed information about the issue..."
                rows="4"
                [(ngModel)]="reportForm.description"></textarea>
            </div>

            <!-- Location -->
            <div class="form-group">
              <label class="form-label" for="issue-location">Location *</label>
              <input 
                type="text" 
                id="issue-location"
                class="form-input" 
                placeholder="Street address or area in Spello"
                [(ngModel)]="reportForm.location">
            </div>

            <!-- Priority -->
            <div class="form-group">
              <label class="form-label">Priority Level</label>
              <div class="priority-buttons">
                <button 
                  *ngFor="let priority of priorityLevels" 
                  class="priority-button"
                  [class.selected]="reportForm.priority === priority.value"
                  [style.--priority-color]="priority.color"
                  (click)="reportForm.priority = priority.value">
                  {{ priority.label }}
                </button>
              </div>
            </div>
          </div>

          <!-- Attachments Section -->
          <div class="form-section">
            <h3 class="section-title">Attachments</h3>
            <div class="form-group">
              <label class="form-label">Add Photos or Files</label>
              <div class="attachment-area">
                <button class="attachment-button" (click)="addAttachment()">
                  <span class="attachment-icon">ðŸ“Ž</span>
                  <span class="attachment-text">Add Attachment</span>
                </button>
                <p class="attachment-hint">You can add photos, documents, or other files to help describe the issue</p>
              </div>
              
              <!-- Attachment List -->
              <div class="attachment-list" *ngIf="reportForm.attachments.length > 0">
                <div class="attachment-item" *ngFor="let attachment of reportForm.attachments; let i = index">
                  <span class="attachment-name">{{ attachment }}</span>
                  <button class="remove-attachment" (click)="removeAttachment(i)">
                    <span class="remove-icon">Ã—</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Submit Section -->
          <div class="form-section">
            <h3 class="section-title">Submit Report</h3>
            <div class="submit-options">
              <div class="submit-option">
                <h4 class="submit-title">Submit with CieID</h4>
                <p class="submit-description">Use your digital identity for secure and authenticated submission</p>
                <button class="submit-button cieid-button" (click)="loginWithCieID()">
                  <span class="cieid-icon">ðŸ†”</span>
                  <span class="cieid-text">Login with CieID</span>
                </button>
              </div>
              
              <div class="submit-option">
                <h4 class="submit-title">Submit Anonymously</h4>
                <p class="submit-description">Submit without authentication (limited tracking capabilities)</p>
                <button class="submit-button anonymous-button" (click)="submitReport()">
                  <span class="submit-icon">ðŸ“¤</span>
                  <span class="submit-text">Submit Report</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Bottom Tab Navigation -->
  <nav class="bottom-tab-navigation">
    <button class="tab-button" *ngFor="let category of categories" [class.active]="currentTab === category.id"
      (click)="setTab(category.id)">
      <span class="tab-icon">{{ category.icon }}</span>
      <span class="tab-label">{{ category.name }}</span>
    </button>
  </nav>

  <!-- Floating Action Button -->
  <button class="fab-button" (click)="openChatbot()" [attr.aria-label]="'Open chatbot'">
    <span class="fab-icon">ðŸ¤–</span>
  </button>

  <!-- Chatbot Modal -->
  <div class="modal-overlay" *ngIf="isChatbotOpen" [class.closing]="isClosing" (click)="closeChatbot()">
    <div class="modal-content" [class.closing]="isClosing" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Chat with Olivia</h2>
        <button class="close-button" (click)="closeChatbot()">
          <span class="close-icon">Ã—</span>
        </button>
      </div>
      
      <div class="chatbot-container">
        <!-- Chat Messages -->
        <div class="chat-messages" #chatMessages>
          <!-- Welcome Message -->
          <div class="message bot-message">
            <div class="message-avatar">ðŸ¤–</div>
            <div class="message-content">
              <div class="message-bubble bot-bubble">
                <p>Hello! I'm Olivia, your virtual assistant for Spello citizens. I can help you with information about city services, transport, healthcare, events, and more. How can I assist you today?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
          </div>

          <!-- Sample User Message -->
          <div class="message user-message">
            <div class="message-content">
              <div class="message-bubble user-bubble">
                <p>Where can I pay my local taxes?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
            <div class="message-avatar">ðŸ‘¤</div>
          </div>

          <!-- Sample Bot Response -->
          <div class="message bot-message">
            <div class="message-avatar">ðŸ¤–</div>
            <div class="message-content">
              <div class="message-bubble bot-bubble">
                <p>You can pay your local taxes (IMU, TARI, etc.) through several methods:</p>
                <ul>
                  <li><strong>Online</strong> - Through the municipality website</li>
                  <li><strong>In person</strong> - At the municipal offices during business hours</li>
                  <li><strong>Bank transfer</strong> - Using the payment slips you received</li>
                  <li><strong>Post office</strong> - At any Poste Italiane location</li>
                </ul>
                <p>You can find the Tax Payments service in the Services section above. Would you like more specific information about any of these methods?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
          </div>

          <!-- Another User Message -->
          <div class="message user-message">
            <div class="message-content">
              <div class="message-bubble user-bubble">
                <p>What are the bus schedules for today?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
            <div class="message-avatar">ðŸ‘¤</div>
          </div>

          <!-- Another Bot Response -->
          <div class="message bot-message">
            <div class="message-avatar">ðŸ¤–</div>
            <div class="message-content">
              <div class="message-bubble bot-bubble">
                <p>For current bus schedules, you can check the Transport section where you'll find:</p>
                <ul>
                  <li><strong>Bus Schedules</strong> - Local and regional routes</li>
                  <li><strong>Umbria MobilitÃ </strong> - Official transport website</li>
                  <li><strong>Real-time updates</strong> - Current delays and changes</li>
                </ul>
                <p>The main routes from Spello connect to Perugia, Assisi, and other nearby towns. Would you like information about a specific route?</p>
              </div>
              <div class="message-time">Just now</div>
            </div>
          </div>
        </div>

        <!-- Chat Input -->
        <div class="chat-input-container">
          <div class="chat-input-wrapper">
            <input type="text" 
                   class="chat-input" 
                   placeholder="Ask me about city services, transport, events..."
                   #chatInput>
            <button class="send-button" (click)="sendMessage(chatInput.value); chatInput.value = ''">
              <span class="send-icon">ðŸ“¤</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>